{"version":3,"sources":["file:///D:/cocos/badminton/badminton/assets/Scripts/GameManager.ts"],"names":["_decorator","Component","Animation","Node","Prefab","CCInteger","instantiate","PhysicsSystem2D","Collider2D","Contact2DType","PlayerController","ccclass","property","GameState","BlockType","BlockSizeX","BlockSizeY","GameManger","type","roadHeight","_road","start","setCurState","GS_INIT","oneTotwo","startButton1","active","startMenu1","startMenu2","startExit","startStart","startSettings","twoTogame","gameGround1","startGame","init","instance","enable","generateRoad","player","playerCtrl","initInput","value","GS_PLAYING","GS_END","onContactFeather","selfCollider","otherCollider","contact","block","node","blockAnimation","getComponent","play","Bounce","body","enabledContactListener","removeAllChildren","i","_roadCur","j","roadLength","Math","floor","random","spawnBlockByType","curNode","addChild","setScale","collider","on","BEGIN_CONTACT","setPosition","fireAnimation","BT_STONE","boxPrefab","BT_FIRE","firePrefab","BT_FEATHER","featherPrefab","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Component, Vec3, EventMouse, input, Input, Animation, Node, Prefab, CCInteger, instantiate, PhysicsSystem2D, Collider2D, Contact2DType, IPhysics2DContact, animation } from 'cc';\r\nimport { PlayerController } from './PlayerController';\r\nconst { ccclass, property } = _decorator;\r\n\r\nenum GameState {\r\n    GS_INIT,\r\n    GS_PLAYING,\r\n    GS_END,\r\n};\r\n\r\nenum BlockType {\r\n    BT_NONE,\r\n    BT_STONE,\r\n    BT_FIRE,\r\n    BT_FEATHER,\r\n};\r\nconst BlockSizeX = 75;\r\nconst BlockSizeY = 75;\r\n@ccclass('GameManger')\r\nexport class GameManger extends Component {\r\n    @property({ type: Node })\r\n    startButton1: Node = null;//从第一个开始界面调到第二个界面的按钮\r\n    @property({ type: Node })\r\n    startMenu1: Node = null;//第一个背景\r\n    @property({ type: Node })\r\n    startMenu2: Node = null;\r\n    @property({ type: Node })\r\n    startSettings: Node = null;\r\n    @property({ type: Node })\r\n    startStart: Node = null;\r\n    @property({ type: Node })\r\n    startExit: Node = null;\r\n    @property({ type: Node })\r\n    gameGround1: Node = null;\r\n    @property({ type: Node })\r\n    gameGround2: Node = null;\r\n    @property({ type: Node })\r\n    player: Node = null;\r\n    @property({ type: Prefab })\r\n    public boxPrefab: Prefab | null = null;\r\n    @property({ type: Prefab })\r\n    public featherPrefab: Prefab | null = null;\r\n    @property({ type: Prefab })\r\n    public firePrefab: Prefab | null = null;\r\n    @property({ type: CCInteger })\r\n    public roadLength: number = 20;\r\n    public roadHeight: number = 20;\r\n\r\n    private _road = [];\r\n\r\n    @property({ type: PlayerController })\r\n    public playerCtrl: PlayerController | null = null;\r\n\r\n    start() {\r\n        this.setCurState(GameState.GS_INIT);\r\n    }\r\n    oneTotwo() {\r\n        this.startButton1.active = false;\r\n        this.startMenu1.active = false;\r\n        this.startMenu2.active = true;\r\n        this.startExit.active = true;\r\n        this.startStart.active = true;\r\n        this.startSettings.active = true;\r\n    }\r\n    twoTogame() {\r\n        this.startMenu2.active = false;\r\n        this.startExit.active = false;\r\n        this.startStart.active = false;\r\n        this.startSettings.active = false;\r\n        this.gameGround1.active = true;\r\n        this.startGame();\r\n    }\r\n    init() {\r\n    }\r\n    startGame() {\r\n        PhysicsSystem2D.instance.enable = true;\r\n        this.generateRoad();\r\n        this.player.active = true;\r\n        this.playerCtrl.initInput(true);\r\n    }\r\n    setCurState(value: GameState) {\r\n        switch (value) {\r\n            case GameState.GS_INIT:\r\n                this.init();\r\n                break;\r\n            case GameState.GS_PLAYING:\r\n                this.startGame();\r\n                break;\r\n            case GameState.GS_END:\r\n                break;\r\n        }\r\n    }\r\n    onContactFeather(selfCollider: Collider2D, otherCollider: Collider2D, contact: IPhysics2DContact | null) {\r\n        let block = selfCollider.node;\r\n        let blockAnimation = block.getComponent(Animation);\r\n        blockAnimation.play('feather_fly');\r\n        this.playerCtrl.Bounce(20);\r\n        selfCollider.body.enabledContactListener = false;\r\n    }\r\n    //生成地块\r\n    generateRoad() {\r\n        this.node.removeAllChildren();\r\n        this._road = [];\r\n        for (let i = 1; i <= this.roadHeight; i++) {\r\n            let _roadCur: BlockType[] = [];\r\n            for (let j = 1; j <= this.roadLength; j++) {\r\n                if ((i % 2 == 1)) {\r\n                    _roadCur[j] = Math.floor(Math.random() * 4);\r\n                }\r\n                else {\r\n                    _roadCur[j] = 0;\r\n                }\r\n            }\r\n            this._road[i] = _roadCur;\r\n        }\r\n        for (let i = 1; i <= this.roadHeight; i++) {\r\n            for (let j = 1; j <= this.roadLength; j++) {\r\n                let block: Node | null = this.spawnBlockByType(this._road[i][j]);\r\n                if (j - 1 != 0) {\r\n                    if (block) {\r\n                        if (this._road[i][j] == 3) {\r\n                            let curNode = new Node;\r\n                            curNode.addChild(block);\r\n                            this.node.addChild(curNode);\r\n\r\n                            block.setScale(1, -1);\r\n                            let collider = block.getComponent(Collider2D);\r\n                            if (collider) {\r\n                                collider.on(Contact2DType.BEGIN_CONTACT, this.onContactFeather, this);\r\n                            }\r\n                            curNode.setPosition((j - 1) * BlockSizeY, (i - 10) * BlockSizeX, 0);\r\n                            continue;\r\n                        }\r\n                        this.node.addChild(block);\r\n                        if (this._road[i][j] == 2) {\r\n                            let fireAnimation = block.getComponent(Animation);\r\n                            if (fireAnimation) {\r\n                                fireAnimation.play('fire1');\r\n                            }\r\n                        }\r\n                        block.setPosition((j - 1) * BlockSizeY, (i - 10) * BlockSizeX, 0);\r\n                    }\r\n                } else if (i - 10 == -1) {\r\n                    block = this.spawnBlockByType(BlockType.BT_STONE);\r\n                    this.node.addChild(block);\r\n                    block.setPosition((j - 1) * BlockSizeY, (i - 10) * BlockSizeX, 0);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    spawnBlockByType(type: BlockType) {\r\n        if (!this.boxPrefab) {\r\n            return null;\r\n        }\r\n        let block: Node | null = null;\r\n        switch (type) {\r\n            case BlockType.BT_STONE:\r\n                block = instantiate(this.boxPrefab);\r\n                break;\r\n            case BlockType.BT_FIRE:\r\n                block = instantiate(this.firePrefab);\r\n                break;\r\n            case BlockType.BT_FEATHER:\r\n                block = instantiate(this.featherPrefab);\r\n                break;\r\n        }\r\n        return block;\r\n    }\r\n    update(deltaTime: number) {\r\n\r\n    }\r\n}\r\n"]}